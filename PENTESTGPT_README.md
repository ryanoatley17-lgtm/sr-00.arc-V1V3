# PentestGPT Framework

An AI-powered penetration testing assistant designed for ethical, educational, and research purposes.

## ⚠️ CRITICAL LEGAL NOTICE

**THIS TOOL IS FOR AUTHORIZED PENETRATION TESTING ONLY**

By using this tool, you acknowledge and agree that:

1. **Authorization Required**: You must have explicit written authorization before testing any system
2. **Legal Compliance**: Unauthorized access to computer systems is illegal under laws including:
   - Computer Fraud and Abuse Act (CFAA) in the United States
   - Computer Misuse Act in the United Kingdom
   - Similar laws in other jurisdictions
3. **Responsibility**: You accept full legal responsibility for your actions
4. **Ethical Use**: This tool is intended for:
   - Authorized penetration testing engagements
   - Security research with proper authorization
   - Educational purposes in controlled environments
   - Capture The Flag (CTF) competitions

**Unauthorized use of this tool may result in criminal prosecution.**

---

## Overview

PentestGPT is an AI-powered penetration testing assistant that operates in **human-in-the-loop** mode. It guides users through penetration testing tasks interactively, using:

- **Chain-of-Thought (CoT) Reasoning**: Step-by-step logical analysis of security testing decisions
- **Pentesting Task Tree (PTT)**: Hierarchical task management for organized engagements
- **OWASP Top 10 Integration**: Built-in knowledge base of common vulnerabilities
- **Tool Integration**: Wrappers for popular pentesting tools (nmap, nikto, sqlmap, etc.)

### Key Features

✅ **Human-in-the-Loop**: Suggests commands, user executes and provides feedback
✅ **Chain-of-Thought Reasoning**: Transparent reasoning process (Input → Reasoning → Output)
✅ **Task Tree Management**: Organize penetration tests hierarchically
✅ **OWASP Top 10**: Integrated vulnerability knowledge base
✅ **Tool Wrappers**: Automated parsing of tool outputs
✅ **Session Management**: Save and resume penetration testing sessions
✅ **Report Generation**: Automated report creation

---

## Installation

### Requirements

```bash
# Python 3.8 or higher
python3 --version

# Install Python package (if distributed)
pip install pentestgpt

# Or use directly from source
git clone <repository>
cd pentestgpt
```

### Optional: Install Pentesting Tools

The framework works with or without external tools, but for full functionality:

```bash
# Debian/Ubuntu
sudo apt update
sudo apt install nmap nikto dirb sqlmap whatweb hydra

# Arch Linux
sudo pacman -S nmap nikto sqlmap

# macOS (Homebrew)
brew install nmap nikto
```

### Files

- `pentestgpt.py` - Core framework with PTT and CoT reasoning
- `pentestgpt_cli.py` - Interactive command-line interface
- `pentestgpt_tools.py` - Tool integration and wrappers
- `PENTESTGPT_README.md` - This documentation
- `examples/` - Example usage and demonstrations

---

## Quick Start

### Interactive CLI Mode

```bash
# Launch interactive interface
python3 pentestgpt_cli.py
```

**Basic Workflow:**

1. **Start a session**:
   ```
   PentestGPT> start
   Target: 192.168.1.100
   Type: 1 (IP Address)
   Scope: Single host authorized for testing
   ```

2. **Confirm authorization**:
   ```
   PentestGPT> confirm
   Do you have explicit written authorization? yes
   ```

3. **Build task tree**:
   ```
   PentestGPT> build-ptt
   ```

4. **Get next recommendation**:
   ```
   PentestGPT> next
   ```

5. **Execute commands** (outside the tool), then report findings:
   ```
   PentestGPT> finding task_0 "Port 22/tcp open - OpenSSH 7.4"
   PentestGPT> complete task_0
   ```

6. **Generate report**:
   ```
   PentestGPT> report
   ```

### Programmatic Usage

```python
from pentestgpt import PentestGPT

# Initialize
pentest = PentestGPT()

# Setup session
pentest.initialize_session(
    target='192.168.1.100',
    target_type='ip',
    scope='Single host'
)
pentest.confirm_authorization()

# Build standard task tree
pentest.build_standard_ptt()

# Get next recommendation with reasoning
recommendation = pentest.get_next_recommendation()
print(recommendation)

# Add findings
pentest.update_task_with_output(
    task_id='task_0',
    output='nmap scan results...',
    findings=['Port 22/tcp open', 'Port 80/tcp open']
)

# Generate report
report = pentest.generate_report()
print(report)

# Save session
pentest.save_session('session.json')
```

---

## Architecture

### 1. Pentesting Task Tree (PTT)

The PTT represents a penetration test as a hierarchical tree of tasks:

```
⭘ [task_0] Reconnaissance (reconnaissance)
  ⭘ [task_1] Passive Information Gathering (reconnaissance)
  ⭘ [task_2] Active Information Gathering (reconnaissance)
⭘ [task_3] Network Scanning (scanning)
  ⭘ [task_4] Port Scanning (scanning)
⭘ [task_5] Service Enumeration (enumeration)
⭘ [task_6] Vulnerability Analysis (vulnerability_analysis)
⭘ [task_7] Exploitation (exploitation)
⭘ [task_8] Post-Exploitation (post_exploitation)
⭘ [task_9] Reporting (reporting)
```

**Task Statuses:**
- `⭘` Pending
- `→` In Progress
- `✓` Completed
- `⊗` Blocked
- `✗` Failed

### 2. Chain-of-Thought (CoT) Reasoning

Every recommendation includes transparent reasoning:

```
╔═══════════════════════════════════════════════════════════════════
║ CHAIN-OF-THOUGHT REASONING
╠═══════════════════════════════════════════════════════════════════
║ INPUT CONTEXT:
║ Target: 192.168.1.100 (Type: ip)
║
║ REASONING PROCESS:
  1. Target identified as ip: 192.168.1.100
  2. Reconnaissance is the first phase - gather information
  3. For network targets: WHOIS, DNS enumeration
  4. Maintain stealth to avoid triggering IDS/IPS
║
║ OUTPUT RECOMMENDATION:
║ Start with passive reconnaissance:
║ 1. whois 192.168.1.100
║ 2. nslookup 192.168.1.100
║ ...
╚═══════════════════════════════════════════════════════════════════
```

### 3. OWASP Top 10 Knowledge Base

Built-in database of OWASP Top 10 2021 vulnerabilities:

```python
from pentestgpt import OWASPKnowledgeBase

# Get specific category
vuln = OWASPKnowledgeBase.get_owasp_info('A03:2021')
print(vuln['name'])  # "Injection"
print(vuln['test_methods'])

# Search by keyword
results = OWASPKnowledgeBase.search_by_keyword('sql')
```

**Coverage:**
- A01:2021 - Broken Access Control
- A02:2021 - Cryptographic Failures
- A03:2021 - Injection (SQL, Command, XSS, etc.)
- A04:2021 - Insecure Design
- A05:2021 - Security Misconfiguration
- A06:2021 - Vulnerable and Outdated Components
- A07:2021 - Identification and Authentication Failures
- A08:2021 - Software and Data Integrity Failures
- A09:2021 - Security Logging and Monitoring Failures
- A10:2021 - Server-Side Request Forgery (SSRF)

### 4. Tool Integration

Wrappers for common pentesting tools with automatic output parsing:

```python
from pentestgpt_tools import ToolRegistry, NmapWrapper

# Using registry
registry = ToolRegistry()
nmap = registry.get_tool('nmap')

# Direct wrapper usage
nmap = NmapWrapper()
result = nmap.stealth_scan('192.168.1.100')

print(result.findings)
# ['Open port: 22/tcp - ssh (OpenSSH 7.4)',
#  'Open port: 80/tcp - http (Apache 2.4)']

print(result.parsed_data)
# {'open_ports': [{'port': 22, 'protocol': 'tcp', ...}], ...}
```

**Supported Tools:**
- `nmap` - Network scanner
- `nikto` - Web server scanner
- `dirb` - Directory/file brute-forcing
- `sqlmap` - SQL injection testing
- `whatweb` - Web technology identification
- `hydra` - Password cracking

---

## CLI Commands Reference

### Session Management

| Command | Description |
|---------|-------------|
| `start` | Initialize new penetration testing session |
| `confirm` | Confirm authorization to proceed |
| `status` | Show current session status |
| `save <file>` | Save session to JSON file |
| `load <file>` | Load saved session |

### Task Management

| Command | Description |
|---------|-------------|
| `build-ptt` | Build standard pentesting task tree |
| `ptt` | Display current task tree |
| `next` | Get next recommended task with CoT reasoning |
| `current` | Show current task details |
| `complete <task_id>` | Mark task as completed |
| `finding <task_id> <text>` | Add finding to task |
| `block <task_id> <reason>` | Mark task as blocked |

### Knowledge Base

| Command | Description |
|---------|-------------|
| `owasp list` | List all OWASP Top 10 categories |
| `owasp <category>` | Get details on category (e.g., A03:2021) |
| `owasp search <keyword>` | Search OWASP database |

### Reporting

| Command | Description |
|---------|-------------|
| `findings` | List all findings |
| `report` | Generate full penetration test report |

---

## Example Workflows

### Example 1: Web Application Test

```bash
# Start session
PentestGPT> start
Target: https://example.com
Type: 3 (Web Application)
Scope: example.com domain only

# Confirm authorization
PentestGPT> confirm
Do you have explicit written authorization? yes

# Build task tree
PentestGPT> build-ptt

# Get first recommendation
PentestGPT> next

# Execute suggested commands (outside tool):
$ whatweb https://example.com
$ nikto -h https://example.com

# Report findings
PentestGPT> finding task_1 "Apache 2.4.41 detected"
PentestGPT> finding task_1 "X-Frame-Options header missing"
PentestGPT> complete task_1

# Continue with next tasks
PentestGPT> next
...

# Generate final report
PentestGPT> report
```

### Example 2: Network Penetration Test

```python
from pentestgpt import PentestGPT, TaskType

# Initialize
pentest = PentestGPT()
pentest.initialize_session('192.168.1.0/24', 'network', 'Internal network')
pentest.confirm_authorization()

# Custom task tree for network
recon = pentest.ptt.add_task(
    "Network Discovery",
    TaskType.RECONNAISSANCE,
    commands=["nmap -sn 192.168.1.0/24"]
)

scan = pentest.ptt.add_task(
    "Host Scanning",
    TaskType.SCANNING,
    description="Scan discovered hosts",
    commands=["nmap -sS -sV <discovered_hosts>"]
)

# Get recommendations
while True:
    rec = pentest.get_next_recommendation()
    if not rec:
        break

    print(rec)

    # User executes commands and provides feedback
    # ...

# Generate report
pentest.save_session('network_test.json')
```

### Example 3: Using OWASP Knowledge Base

```bash
# List all categories
PentestGPT> owasp list

# Get details on SQL Injection
PentestGPT> owasp A03:2021

# Search for authentication issues
PentestGPT> owasp search authentication

# Get testing methodology
PentestGPT> owasp A07:2021
```

---

## Advanced Usage

### Custom Task Trees

```python
from pentestgpt import PentestGPT, TaskType

pentest = PentestGPT()
pentest.initialize_session('target.com', 'web', 'Web app')
pentest.confirm_authorization()

# Add custom reconnaissance tasks
recon = pentest.ptt.add_task(
    "Advanced Reconnaissance",
    TaskType.RECONNAISSANCE
)

pentest.ptt.add_task(
    "Subdomain Enumeration",
    TaskType.RECONNAISSANCE,
    parent_id=recon.id,
    commands=[
        "amass enum -d target.com",
        "subfinder -d target.com",
        "assetfinder target.com"
    ]
)

pentest.ptt.add_task(
    "GitHub Dorking",
    TaskType.RECONNAISSANCE,
    parent_id=recon.id,
    commands=[
        "trufflehog --regex --entropy=False target.com"
    ]
)

# Add custom exploitation task
pentest.ptt.add_task(
    "Test for SSRF",
    TaskType.EXPLOITATION,
    description="Test server-side request forgery vulnerabilities",
    commands=[
        "Test URL parameters with internal IPs",
        "Attempt cloud metadata access (169.254.169.254)"
    ]
)
```

### Tool Integration

```python
from pentestgpt_tools import (
    NmapWrapper,
    NiktoWrapper,
    ToolCommandGenerator
)

# Use tool wrappers
nmap = NmapWrapper()
result = nmap.stealth_scan('192.168.1.100')

for finding in result.findings:
    print(f"[+] {finding}")

# Parse discovered services
for port_info in result.parsed_data['open_ports']:
    print(f"Port {port_info['port']}: {port_info['service']}")

# Generate context-aware commands
commands = ToolCommandGenerator.generate_enumeration_commands(
    target='192.168.1.100',
    service='http',
    port=80
)

for cmd in commands:
    print(f"$ {cmd}")
```

### Session Persistence

```python
# Save session
pentest.save_session('session_20240115.json')

# Load and resume
from pentestgpt import PentestGPT

pentest = PentestGPT()
# Load session data manually or through CLI
```

---

## Security Considerations

### Authorization Documentation

Before using PentestGPT, ensure you have:

1. **Written Authorization**: Signed document from system owner
2. **Scope Definition**: Clear boundaries of what can be tested
3. **Rules of Engagement**: Timing, methods, and limitations
4. **Emergency Contacts**: Who to contact if issues arise
5. **Legal Review**: Contracts reviewed by legal counsel

### Operational Security

- **Use VPNs**: Route traffic through authorized channels
- **Rate Limiting**: Avoid DoS through aggressive scanning
- **Logging**: Keep detailed logs of all activities
- **Time Windows**: Respect agreed-upon testing windows
- **Communication**: Report critical findings immediately

### Data Handling

- **Sensitive Data**: Do not exfiltrate production data
- **Credentials**: Handle discovered credentials securely
- **Reporting**: Encrypt reports containing sensitive findings
- **Cleanup**: Remove any test artifacts after engagement

---

## Limitations and Disclaimers

### Tool Limitations

- **AI Suggestions**: Recommendations may not be perfect; use professional judgment
- **False Positives**: Tool outputs may contain false positives
- **Coverage**: Cannot guarantee 100% vulnerability coverage
- **Tool Availability**: External tools must be installed separately

### Legal Disclaimers

- **No Warranty**: Provided "as-is" without warranty of any kind
- **User Responsibility**: Users are solely responsible for their actions
- **Not Legal Advice**: This documentation is not legal advice
- **Jurisdiction**: Laws vary by jurisdiction; consult local legal counsel

### Ethical Guidelines

PentestGPT is designed to support ethical hacking. Users must:

- ✅ Obtain explicit authorization before testing
- ✅ Respect scope and rules of engagement
- ✅ Report findings responsibly
- ✅ Protect sensitive data discovered during testing
- ❌ Never use for unauthorized access
- ❌ Never cause damage or disruption
- ❌ Never exfiltrate or misuse data

---

## Contributing

Contributions are welcome! Areas for improvement:

- Additional tool integrations
- Enhanced parsing algorithms
- More CoT reasoning templates
- Extended OWASP coverage
- Additional vulnerability checks

---

## References

### Standards and Frameworks

- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [PTES - Penetration Testing Execution Standard](http://www.pentest-standard.org/)
- [NIST SP 800-115](https://csrc.nist.gov/publications/detail/sp/800-115/final)

### Tools Documentation

- [Nmap](https://nmap.org/docs.html)
- [Metasploit](https://docs.metasploit.com/)
- [Burp Suite](https://portswigger.net/burp/documentation)

### Legal Resources

- [CFAA - Computer Fraud and Abuse Act](https://www.law.cornell.edu/uscode/text/18/1030)
- [EC-Council Code of Ethics](https://www.eccouncil.org/code-of-ethics/)

---

## License

This tool is provided for educational and authorized security testing purposes only.

**Use responsibly. Test ethically. Stay legal.**

---

## Support

For issues, questions, or contributions:
- GitHub Issues: [repository issues page]
- Documentation: This README
- Examples: See `examples/` directory

**Remember: With great power comes great responsibility. Use this tool ethically and legally.**
